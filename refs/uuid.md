---
title: UUID 结构
outline: deep
createAt: 2025-04-24 17:26
updateAt: 2025-06-10 22:17
expires: 3650
order: 4
excerpt:
    通用唯一标识符 UUID（Universally Unique IDentifier）的结构梳理。
---

> 也称为全局唯一标识符 GUID（Globally Unique IDentifier）。

> UUIDs were originally used in the Apollo Network Computing System \(NCS\),
> later in the Open Software Foundation's \(OSF's\) Distributed Computing Environment \(DCE\),
> and then in Microsoft Windows platforms. —— [RFC 9562](https://www.rfc-editor.org/rfc/rfc9562.html)

UUID 有很多不同风格的字符串表达，但均为 16 字节 128 比特，通常用十六进制字符 8-4-4-4-12 结构记录，本文全文使用第一种以统一说明。

<pre style="text-align: center">
cf839610-d2d3-40de-9dd0-3fbb9fdbfa31<br/>
B80A6F9C-4B1A-CD04-5B66-80C05BC7803E<br/>
{0B17CDEF-188E-457B-5EA6-29E7B33E5ECD}<br/>
7b664fea7aec471abfa032ef581da495<br/>
4A19C1492041EB73E340B14B025872C8<br/>
urn:uuid:92af5f77-75e8-4219-9438-b5705abf12cb<br/>
</pre>

> [!TIP] 正则表达式
> ```regexp
> (^[0-9a-f]{32}$|[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})
> ```

## UUID 种类 {#variant}

UUID 的结构取决于“种类”字段（`variant`）：

<pre style="text-align: center">
00112233-4455-6677-<strong>88</strong>99-aabbccddeeff
</pre>

取值有下：

| 比特位                      | 高位目测标志                     | 种类                 |
|--------------------------|----------------------------|--------------------|
| <pre>**0**xxx xxxx</pre> | <pre>0,1,2,3,4,5,6,7</pre> | Apollo NCS UUID    |
| <pre>**10**xx xxxx</pre> | <pre>8,9,A,B</pre>         | OSF's DCE UUID     |
| <pre>**110**x xxxx</pre> | <pre>C,D</pre>             | 微软 COM / DCOM UUID |
| <pre>**111**x xxxx</pre> | <pre>E,F</pre>             | _保留_               |

> [!IMPORTANT] 切记
> 上表中的 `x` 表示不关心比特位的值，因此该字段 **不一定** 会占用全部 8 个比特位，具体取决于相应种类规定的格式。

## OSF's DCE UUID

OSF's DCE UUID 由 [RFC 9562](https://www.rfc-editor.org/rfc/rfc9562.html) 定义，有不同版本，通过“版本”字段（`version`）指示：

<pre style="text-align: center">
00112233-4455-<strong>6</strong>677-8899-aabbccddeeff
</pre>

取值有下：

|        |     | 要素                   | 说明                                  |
|:------:|:---:|----------------------|-------------------------------------|
| `0001` | `1` | 公历时间戳，时钟序号，节点地址      | [UUIDv1](#uuidv1)。                  |
| `0110` | `6` | 公历时间戳，时钟序号，节点地址      | [UUIDv6](#uuidv6)。与 v1 相比调整了时间戳的顺序。 |
| `0010` | `2` | 公历时间戳，时钟序号，节点地址，本地信息 | [UUIDv2](#uuidv2)。DCE 安全 UUID。      |
| `0011` | `3` | MD5 杂凑值              | [UUIDv3](#uuidv3)。命名空间下唯一名称的杂凑值。    |
| `0101` | `5` | SHA-1 杂凑值            | [UUIDv5](#uuidv5)。命名空间下唯一名称的杂凑值。    |
| `0100` | `4` | 随机数                  | [UUIDv4](#uuidv4)。                  |
| `0111` | `7` | 随机数，Unix 时间戳         | [UUIDv7](#uuidv7)。                  |
| `1000` | `8` | （自定义）                | [UUIDv8](#uuidv8)。自定义 UUID。         |
| `0000` | `0` |                      | 未使用。                                |
|   其它   |     |                      | 保留。                                 |

### UUIDv1

第一版 UUID 包含公历时间戳、时钟序号、MAC 地址。

> [!TIP] 时间戳
> 单位为 100 纳秒，Epoch 为 1582-10-15 00:00:00.00（UTC+0），60 比特可存储约 3655 年 324 天 21 小时 21 分钟。

以下表为例，其中包含的时间戳是 `0x677445500112233`，即 46591621832016747500 纳秒，合
`46591621832.016745` 秒，对应时间为 3059-03-20 21:10:32.016745。

> [!TIP] 碰撞概率
> 理论为每个节点每秒 1638 亿分之一（1/1638,3000,0000）。

| 位置                                                  | 字段   | 取值范围               | 说明                               |
|-----------------------------------------------------|------|--------------------|----------------------------------|
| <pre>**00112233**-4455-1677-8899-aabbccddeeff</pre> | 时间戳  | 0，2<sup>60</sup>-1 | <pre>0x6774455**00112233**</pre> |
| <pre>00112233-**4455**-1677-8899-aabbccddeeff</pre> | 时间戳  | 0，2<sup>60</sup>-1 | <pre>0x677**4455**00112233</pre> |
| <pre>00112233-4455-**1**677-8899-aabbccddeeff</pre> | 版本   | 固定值                | OSF's DCE UUID 的版本。              |
| <pre>00112233-4455-1**677**-8899-aabbccddeeff</pre> | 时间戳  | 0，2<sup>60</sup>-1 | <pre>0x**677**445500112233</pre> |
| <pre>00112233-4455-1677-**8899**-aabbccddeeff</pre> |      |                    |                                  |
| ├─<pre> **10**00 1000 1001 1001</pre>               | 种类   | 固定值                | UUID 种类。                         |
| └─<pre> 10**00 1000 1001 1001**</pre>               | 时钟序号 | 0，2<sup>14</sup>-1 | 用以避免时钟回拨或节点变化导致的重复。              |
| <pre>00112233-4455-1677-8899-**aabbccddeeff**</pre> | 节点   | 0，2<sup>48</sup>-1 | IEEE 802 MAC 地址，通常是主机地址或随机得出。    |

### UUIDv2

> [!WARNING] 注意
> 这一版的 UUID 并未在 RFC 中约定其结构。

第二版 UUID 在 [UUIDv1](#uuidv1) 的基础上借用了“时间戳”的一部分位置来存放“本地信息”。

> [!TIP] 时间戳
> 单位为 100 纳秒，Epoch 为 1582-10-15 00:00:00.00（UTC+0），60 比特可存储约 3655 年 324 天 21 小时 21 分钟。

以下表为例，其中包含的“时间戳”是 `0x677445500000000`，即 46591621831904460800 纳秒，合
`46591621831.9044608` 秒，对应时间为 3059-03-20 21:10:31.9044608。

> [!WARNING] 碰撞概率
> 由于“时间戳”的低 32 位被用作“本地域编号”，最大值 `0xFFFFFFFF` 即 429496729500 纳秒，合 429.4967295
> 秒，因此在其它字段相同的情况下，每隔 <u>7 分钟 9.4967295 秒</u> 才能依靠时钟变动来生成一个新的 UUID！

- 在非 POSIX 系统上，“本地域”与“本地域编号”由系统定义。
- 在 POSIX 系统上，
  - “本地域”为 `0` 表示“本地域编号”用作用户编号（UID）。
  - “本地域”为 `1` 表示“本地域编号”用作用户组编号（GID）。

| 位置                                                  | 字段    | 取值范围               | 说明                                           |
|-----------------------------------------------------|-------|--------------------|----------------------------------------------|
| <pre>**00112233**-4455-2677-8899-aabbccddeeff</pre> | 本地域编号 | 0，2<sup>32</sup>-1 | <pre>0x6774455**00000000**</pre>，含义取决于“本地域”。 |
| <pre>00112233-**4455**-2677-8899-aabbccddeeff</pre> | 时间戳   | 0，2<sup>60</sup>-1 | <pre>0x677**4455**00000000</pre>             |
| <pre>00112233-4455-**2**677-8899-aabbccddeeff</pre> | 版本    | 固定值                | OSF's DCE UUID 的版本。                          |
| <pre>00112233-4455-2**677**-8899-aabbccddeeff</pre> | 时间戳   | 0，2<sup>60</sup>-1 | <pre>0x**677**445500000000</pre>             |
| <pre>00112233-4455-2677-**8899**-aabbccddeeff</pre> |       |                    |                                              |
| ├─<pre> **10**00 1000 1001 1001</pre>               | 种类    | 固定值                | UUID 种类。                                     |
| ├─<pre> 10**00 1000** 1001 1001</pre>               | 时钟序号  | 0，2<sup>6</sup>-1  | 用以避免时钟回拨或节点变化导致的重复。                          |
| └─<pre> 1000 1000 **1001 1001**</pre>               | 本地域   | 0，2<sup>8</sup>-1  |                                              |
| <pre>00112233-4455-2677-8899-**aabbccddeeff**</pre> | 节点    | 0，2<sup>48</sup>-1 | IEEE 802 MAC 地址，通常是主机地址或随机得出。                |

### UUIDv3

第三版 UUID 基于 MD5 杂凑值。

根据“命名空间”对一个“名称”进行 MD5 杂凑，得到 128 位杂凑值，然后在“版本”和“种类”的位置上用相应的 **固定值** 进行替换。

| 位置                                                                  | 字段  | 取值范围                | 字段                  |
|---------------------------------------------------------------------|-----|---------------------|---------------------|
| <pre>**00112233**-**4455**-3**677**-**8899**-**aabbccddeeff**</pre> | 杂凑值 | 0，2<sup>122</sup>-1 |                     |
| <pre>00112233-4455-**3**677-8899-aabbccddeeff</pre>                 | 版本  | 固定值                 | OSF's DCE UUID 的版本。 |
| <pre>00112233-4455-3677-**8**899-aabbccddeeff</pre>                 | 种类  | 固定值                 | UUID 的种类，仅占用高 2 位。  |

### UUIDv4

第四版 UUID 基于\(伪\)随机数。

生成 128 位随机数或伪随机数，然后在“版本”和“种类”的位置上用相应的 **固定值** 进行替换。

| 位置                                                                  | 字段  | 取值范围                | 字段                  |
|---------------------------------------------------------------------|-----|---------------------|---------------------|
| <pre>**00112233**-**4455**-4**677**-**8899**-**aabbccddeeff**</pre> | 随机数 | 0，2<sup>122</sup>-1 |                     |
| <pre>00112233-4455-**4**677-8899-aabbccddeeff</pre>                 | 版本  | 固定值                 | OSF's DCE UUID 的版本。 |
| <pre>00112233-4455-4677-**8**899-aabbccddeeff</pre>                 | 种类  | 固定值                 | UUID 的种类，仅占用高 2 位。  |

### UUIDv5

第五版 UUID 基于 SHA-1 杂凑值。

根据“命名空间”对一个“名称”进行 SHA-1 杂凑，截取杂凑值的高 128 位，丢弃低 32 位，然后在“版本”和“种类”的位置上用相应的 **固定值** 进行替换。

| 位置                                                                  | 字段  |                     | 字段                  |
|---------------------------------------------------------------------|-----|---------------------|---------------------|
| <pre>**00112233**-**4455**-5**677**-**8899**-**aabbccddeeff**</pre> | 杂凑值 | 0，2<sup>122</sup>-1 |                     |
| <pre>00112233-4455-**5**677-8899-aabbccddeeff</pre>                 | 版本  | 固定值                 | OSF's DCE UUID 的版本。 |
| <pre>00112233-4455-5677-**8**899-aabbccddeeff</pre>                 | 种类  | 固定值                 | UUID 的种类，仅占用高 2 位。  |

### UUIDv6

第六版 UUID 是 [UUIDv1](#uuidv1) 的兼容版本，仅是调整了字段顺序以提高数据库性能。

> [!TIP] 时间戳
> 单位为 100 纳秒，Epoch 为 1582-10-15 00:00:00.00（UTC+0），60 比特可存储约 3655 年 324 天 21 小时 21 分钟。

以下表为例，其中包含的时间戳是 `0x001122334455677`，即 30141738682533500 纳秒，合
`30141738.6825335` 秒，对应时间为 1583-09-28 20:42:18.6825335。

> [!TIP] 碰撞概率
> 理论为每个节点每秒 1638 亿分之一（1/1638,3000,0000）。

| 位置                                                  | 字段   | 取值范围               | 说明                               |
|-----------------------------------------------------|------|--------------------|----------------------------------|
| <pre>**00112233**-4455-6677-8899-aabbccddeeff</pre> | 时间戳  | 0，2<sup>60</sup>-1 | <pre>0x**00112233**4455677</pre> |
| <pre>00112233-**4455**-6677-8899-aabbccddeeff</pre> | 时间戳  | 0，2<sup>60</sup>-1 | <pre>0x00112233**4455**677</pre> |
| <pre>00112233-4455-**6**677-8899-aabbccddeeff</pre> | 版本   | 固定值                | OSF's DCE UUID 的版本。              |
| <pre>00112233-4455-6**677**-8899-aabbccddeeff</pre> | 时间戳  | 0，2<sup>60</sup>-1 | <pre>0x001122334455**677**</pre> |
| <pre>00112233-4455-6677-**8899**-aabbccddeeff</pre> |      |                    |                                  |
| ├─<pre> **10**00 1000 1001 1001</pre>               | 种类   | 固定值                | UUID 种类。                         |
| └─<pre> 10**00 1000 1001 1001**</pre>               | 时钟序号 | 0，2<sup>14</sup>-1 | 用以避免时钟回拨或节点变化导致的重复。              |
| <pre>00112233-4455-6677-8899-**aabbccddeeff**</pre> | 节点   | 0，2<sup>48</sup>-1 | IEEE 802 MAC 地址，通常是主机地址或随机得出。    |

### UUIDv7

第七版 UUID 包含随机数、Unix 时间戳。

> [!TIP] 时间戳
> 单位为 1 毫秒，Epoch 为 1970-01-01 00:00:00.00（UTC+0），  
> 48 比特可存储约 8925 年 187 天 5 小时 31 分钟 50.655 秒。

以下表为例，时间戳为 `0x001122334455`，合 73588229.205 秒，对应时间为 1972-05-02 01:10:29.205。

> [!TIP] 碰撞概率
> 理论为每秒 28 亿亿分之一（1/28,1474,9767,1065,6000）。

| 位置                                                          | 字段  | 取值范围               | 说明                  |
|-------------------------------------------------------------|-----|--------------------|---------------------|
| <pre>**00112233**-**4455**-7677-8899-aabbccddeeff</pre>     | 时间戳 | 0，2<sup>48</sup>-1 | 毫秒级 Unix 时间戳。       |
| <pre>00112233-4455-7**677**-**8899**-**aabbccddeeff**</pre> | 随机数 | 0，2<sup>74</sup>-1 |                     |
| <pre>00112233-4455-**7**677-8899-aabbccddeeff</pre>         | 版本  | 固定值                | OSF's DCE UUID 的版本。 |
| <pre>00112233-4455-7677-**8**899-aabbccddeeff</pre>         | 种类  | 固定值                | UUID 的种类，仅占用高 2 位。  |

### UUIDv8

第八版 UUID 用于生成自定义值。

字段的分布、比特位的含义、字节的顺序等等，都完全取决于生成者，唯一的要求是在“版本”和“种类”的位置上用相应的 **固定值** 进行替换。

| 位置                                                                  | 字段 | 取值范围                | 说明                  |
|---------------------------------------------------------------------|----|---------------------|---------------------|
| <pre>**00112233**-**4455**-8**677**-**8899**-**aabbccddeeff**</pre> |    | 0，2<sup>122</sup>-1 | 自定义结构。              |
| <pre>00112233-4455-**8**677-8899-aabbccddeeff</pre>                 | 版本 | 固定值                 | OSF's DCE UUID 的版本。 |
| <pre>00112233-4455-8677-**8**899-aabbccddeeff</pre>                 | 种类 | 固定值                 | UUID 的种类，仅占用高 2 位。  |

## Apollo NCS UUID

由 Apollo NCS 规定的全零 UUID，用于表示没有 UUID 值，在意思上相当于数据库字段中的
`NULL`，同时也被 [RFC 9562](https://www.rfc-editor.org/rfc/rfc9562.html) 规定。

<pre style="text-align: center">
00000000-0000-<strong>0</strong>000-0000-000000000000
</pre>

## 参考

- [RFC 9562：Universally Unique IDentifiers \(UUIDs\)](https://www.rfc-editor.org/rfc/rfc9562.html)
- [RFC 4122：A Universally Unique IDentifier (UUID) URN Namespace](https://www.rfc-editor.org/rfc/rfc4122)
- [Security-Version \(Version 2\) UUIDs](https://pubs.opengroup.org/onlinepubs/9696989899/chap5.htm#tagcjh_08_02_01_01)，DCE 1.1: Authentication and Security Services
- [What Happened to UUIDv2?](https://playfulprogramming.com/posts/what-happened-to-uuid-v2)，Playful Programming


<style scoped>
pre {
    line-height: 16px;
}

table pre {
    line-height: 8px;
    display: inline;
}

th, td {
    text-wrap: nowrap;
}
</style>
